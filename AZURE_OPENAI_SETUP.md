# Azure OpenAI Setup Guide for AI Car Summaries

## Overview
Your car estimation app now uses Azure OpenAI to generate intelligent summaries for each car in the gallery. This showcases the complete Azure AI ecosystem: **Azure AutoML for price prediction** + **Azure OpenAI for content generation**.

## Prerequisites
- Azure subscription
- Azure OpenAI resource created

## Step 1: Create Azure OpenAI Resource

1. Go to [Azure Portal](https://portal.azure.com)
2. Click **Create a resource**
3. Search for **Azure OpenAI**
4. Click **Create**
5. Fill in the details:
   - **Subscription**: Your subscription
   - **Resource Group**: Use existing `rg-dev-foundry` (or create new)
   - **Region**: Choose a region (e.g., `Sweden Central`, `East US`, `West Europe`)
   - **Name**: e.g., `car-pricer-openai`
   - **Pricing Tier**: Standard S0
6. Click **Review + Create** â†’ **Create**

## Step 2: Deploy a Model

1. Go to your Azure OpenAI resource
2. Click **Go to Azure OpenAI Studio** (or navigate to [oai.azure.com](https://oai.azure.com))
3. Click **Deployments** in the left menu
4. Click **+ Create new deployment**
5. Choose a model:
   - **Recommended**: `gpt-4o-mini` (fast, cost-effective)
   - **Alternative**: `gpt-4o`, `gpt-4` (higher quality, more expensive)
6. Give it a deployment name: e.g., `gpt-4o-mini`
7. Click **Create**

## Step 3: Get Your Credentials

1. In Azure OpenAI Studio, click **Keys and Endpoint** (or in Azure Portal â†’ your resource â†’ Keys and Endpoint)
2. Copy the following values:
   - **Endpoint**: e.g., `https://car-pricer-openai.openai.azure.com/`
   - **Key**: Your API key (Key 1 or Key 2)
   - **Deployment Name**: The name you gave in Step 2 (e.g., `gpt-4o-mini`)

## Step 4: Configure Environment Variables

### Local Development (.env.local)

Update your `.env.local` file with the values from Step 3:

```env
AZURE_OPENAI_ENDPOINT="https://your-resource-name.openai.azure.com/"
AZURE_OPENAI_API_KEY="your_actual_api_key_here"
AZURE_OPENAI_DEPLOYMENT_NAME="gpt-4o-mini"
```

### Azure Web App Configuration

1. Go to [Azure Portal](https://portal.azure.com)
2. Navigate to your Web App: `myfestivecar1`
3. Click **Configuration** (under Settings)
4. Click **+ New application setting** for each:
   - Name: `AZURE_OPENAI_ENDPOINT` | Value: `https://your-resource-name.openai.azure.com/`
   - Name: `AZURE_OPENAI_API_KEY` | Value: `your_actual_api_key_here`
   - Name: `AZURE_OPENAI_DEPLOYMENT_NAME` | Value: `gpt-4o-mini`
5. Click **Save** at the top
6. Click **Continue** to restart the app

## Step 5: Test Locally

```bash
cd car-pricer
npm run dev
```

1. Navigate to `http://localhost:3000`
2. Go to the **Stored Car Valuations** page
3. Click **Get AI Summary** on any car
4. You should see:
   - Loading spinner
   - AI-generated summary appears
   - Footer showing "Generated by Azure OpenAI"

## Step 6: Deploy to Azure

After testing locally, deploy to Azure:

```bash
npm run build
# Create zip file of necessary files
# Deploy using Azure CLI or VS Code extension
```

Remember to configure the environment variables in Azure Web App Settings (Step 4).

## Features Implemented

âœ… **On-demand AI summaries** - No database storage, generated real-time
âœ… **Loading states** - Smooth UX with spinner and status messages
âœ… **Error handling** - Graceful fallbacks if API fails
âœ… **Cost-effective** - Using `gpt-4o-mini` (~$0.0001 per summary)
âœ… **Azure ecosystem showcase** - AutoML + OpenAI integration

## Cost Estimation

With `gpt-4o-mini`:
- **Input**: ~150 tokens per request
- **Output**: ~80 tokens per response
- **Cost per summary**: ~$0.00002 (essentially free)
- **1,000 summaries**: ~$0.02
- **10,000 summaries/month**: ~$0.20

## Troubleshooting

### Error: "AI service not configured"
- Check that all 3 environment variables are set correctly
- Verify endpoint includes `https://` and trailing `/`

### Error: "Invalid Azure OpenAI API key"
- Double-check the API key from Azure Portal
- Make sure you copied the full key without spaces

### Error: "Azure OpenAI deployment not found"
- Verify the deployment name matches exactly (case-sensitive)
- Check that the model is deployed in Azure OpenAI Studio

### Error: "Unable to connect to Azure OpenAI service"
- Check your internet connection
- Verify the endpoint URL is correct
- Check if Azure OpenAI resource is in a supported region

## Next Steps

Consider adding:
- **Caching**: Store summaries in Cosmos DB to reduce API calls
- **Streaming**: Show summary as it's being generated
- **Personalization**: Allow users to request specific aspects (pricing analysis, reliability, etc.)
- **Comparison**: Generate comparative summaries for multiple cars

---

**Built with Azure AI** ðŸš€
- Azure AutoML: Car price prediction
- Azure OpenAI: Intelligent summaries
- Azure Cosmos DB: Data storage
- Azure Blob Storage: Image hosting
